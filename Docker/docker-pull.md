# docker pull

```shell script
docker pull redis
Using default tag: latest
latest: Pulling from library/redis
75646c2fb410: Already exists # 分层下载 image 联合文件系统
50c782b7d4d9: Pull complete 
e624b72b42cc: Pull complete 
dfcb918317cc: Pull complete 
d8fcc46eaa64: Pull complete 
c83989cecb0f: Pull complete 
Digest: sha256:a63d3f66fb2f69d955d4f2ca0b229385537a77872ffc04290acae65aed5317d2 # 签名
Status: Downloaded newer image for redis:latest
docker.io/library/redis:latest # image的真实地址
```

Delete multiple images

```shell script
docker rmi -f images_id_1 images_id_2
```

Delte all images

```shell script
docker rmi -f $(docker images -aq)
```

## Docker image and layer

```shell script
$ docker pull nginx
Using default tag: latest
latest: Pulling from library/nginx
f7ec5a41d630: Pull complete 
deac85b6e34f: Pull complete 
36acc35632db: Pull complete 
2e4b03180fae: Pull complete 
81fc5ccdd311: Pull complete 
36536268535e: Pull complete 
Digest: sha256:0e9fc81d8d894c4e5d32be1b78ab6c85ca955e0ce50020e392e014f34b81c6c5
Status: Downloaded newer image for nginx:latest
docker.io/library/nginx:latest
```

```shell script
$ docker images nginx
REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE
nginx               latest              519e12e2a84a        2 hours ago         133MB
```

Get layer diff_ids based on image id

```shell script
# cd /var/lib/docker/image/overlay2/imagedb/content/sha256
# cat 519e12e2a84a* | python -m json.tool
    ...
    "rootfs": {
        "diff_ids": [
            "sha256:7e718b9c0c8c2e6420fe9c4d1d551088e314fe923dce4b2caf75891d82fb227d",
            "sha256:47ba6c704819054eab359dc105ad051d32f53d3be1fa49c248a7ce81861dc0e3",
            "sha256:a433210552afca20ce4f57b4eae87b7b507eb085d53bbd1cd8882db6fafb4e68",
            "sha256:097985a72f15de89ac9fead20e587eade00de8858253c421844dff4d81715c67",
            "sha256:962b263b732e7779631b6d6d67c53d495cfae35f76e3477ed97230267d8fb0c3",
            "sha256:7703406462db5ce7e6f83eebc9f0fe7c800022018eb6ad175fa1066ca04f1837"
        ],
        "type": "layers"
    }
    ...
```

The fisrt diff id is the bottom one.

```shell script
# cd /var/lib/docker/image/overlay2/layerdb/sha256
# ls -l 7e718b9c0c8c2e6420fe9c4d1d551088e314fe923dce4b2caf75891d82fb227d
total 256
-rw-r--r-- 1 root root     64 Apr 10 17:06 cache-id
-rw-r--r-- 1 root root     71 Apr 10 17:06 diff
-rw-r--r-- 1 root root      8 Apr 10 17:06 size
-rw-r--r-- 1 root root 249610 Apr 10 17:06 tar-split.json.gz
```

Get rootfs in cache-id

```shell script
# cat 7e718b9c0c8c2e6420fe9c4d1d551088e314fe923dce4b2caf75891d82fb227d/cache-id 
9945a3e48e0d9e36b8c541f38d6b7d9f91de83fa38fd72a6c36c1459318423cc
```

Get rootfs

```shell script
# cd /var/lib/docker/overlay2/
# # tree -L 2 9945a3e48e0d9e36b8c541f38d6b7d9f91de83fa38fd72a6c36c1459318423cc 
9945a3e48e0d9e36b8c541f38d6b7d9f91de83fa38fd72a6c36c1459318423cc
├── committed
├── diff
│   ├── bin
│   ├── boot
│   ├── dev
│   ├── etc
│   ├── home
│   ├── lib
│   ├── lib64
│   ├── media
│   ├── mnt
│   ├── opt
│   ├── proc
│   ├── root
│   ├── run
│   ├── sbin
│   ├── srv
│   ├── sys
│   ├── tmp
│   ├── usr
│   └── var
└── link

20 directories, 2 files
```

The second layer can be generated by the following command

```shell script
# echo -n "sha256:7e718b9c0c8c2e6420fe9c4d1d551088e314fe923dce4b2caf75891d82fb227d sha256:47ba6c704819054eab359dc105ad051d32f53d3be1fa49c248a7ce81861dc0e3" | sha256sum
0e4de0b835ccccb24f146ac85b23d63c661deba6bb7f8e7291b016e3ef6cd81b  -

# ls -l 0e4de0b835ccccb24f146ac85b23d63c661deba6bb7f8e7291b016e3ef6cd81b
total 100
-rw-r--r-- 1 root root    64 Apr 10 17:06 cache-id
-rw-r--r-- 1 root root    71 Apr 10 17:06 diff
-rw-r--r-- 1 root root    71 Apr 10 17:06 parent
-rw-r--r-- 1 root root     8 Apr 10 17:06 size
-rw-r--r-- 1 root root 84398 Apr 10 17:06 tar-split.json.gz

# cat 0e4de0b835ccccb24f146ac85b23d63c661deba6bb7f8e7291b016e3ef6cd81b/parent
sha256:7e718b9c0c8c2e6420fe9c4d1d551088e314fe923dce4b2caf75891d82fb227d
```
